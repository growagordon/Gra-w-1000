<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Tysiąc Solo z Botami</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      text-align: center;
      padding: 10px;
    }
    h1 {
      color: #333;
    }
    .hand, #bots-info {
      margin: 10px auto;
      max-width: 600px;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 6px;
    }
    button.card {
      padding: 8px 14px;
      font-size: 18px;
      border-radius: 6px;
      border: 1px solid #999;
      background: white;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s;
    }
    button.card:hover {
      background-color: #d3e3fd;
    }
    #info {
      margin: 12px;
      min-height: 50px;
      font-size: 16px;
      white-space: pre-line;
    }
    #start-btn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 18px;
      border-radius: 8px;
      cursor: pointer;
      background-color: #3478f6;
      color: white;
      border: none;
      user-select: none;
      transition: background-color 0.3s;
    }
    #start-btn:hover {
      background-color: #1a5edb;
    }
  </style>
</head>
<body>
  <h1>Tysiąc Solo z Botami</h1>

  <div id="bots-info"></div>

  <div id="player-hand" class="hand"></div>

  <div id="info"></div>

  <button id="start-btn">Nowa Gra</button>

  <script>
    // Stałe i pomocnicze funkcje
    const suits = ['♥️','♦️','♣️','♠️'];
    const ranks = ['9','10','J','Q','K','A'];
    const values = { '9': 0, '10': 10, 'J': 2, 'Q': 3, 'K': 4, 'A': 11 };

    // Funkcja tasująca
    function shuffle(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    // Funkcja tworząca talię 24 kart
    function createDeck() {
      const deck = [];
      for (let s of suits) {
        for (let r of ranks) {
          deck.push({ suit: s, rank: r, value: values[r] });
        }
      }
      return shuffle(deck);
    }

    // Funkcje do znajdowania najwyższej i najniższej karty
    function highestCard(cards) {
      return cards.reduce((a, b) => a.value > b.value ? a : b);
    }

    function lowestCard(cards) {
      return cards.reduce((a, b) => a.value < b.value ? a : b);
    }

    // Usuwa kartę z ręki i zwraca ją
    function removeCard(hand, card) {
      const idx = hand.indexOf(card);
      if (idx !== -1) hand.splice(idx, 1);
      return card;
    }
  </script>
// --- Lista botów z różnymi stylami ---

const botList = [
  {
    name: "Pan Ryzykant",
    bid: () => 115 + Math.floor(Math.random() * 20),
    playCard: (hand, leadSuit) => {
      let same = hand.filter(c => c.suit === leadSuit);
      return removeCard(hand, highestCard(same.length ? same : hand));
    }
  },
  {
    name: "Sierżant Spokój",
    bid: () => 100 + Math.floor(Math.random() * 10),
    playCard: (hand, leadSuit) => {
      let same = hand.filter(c => c.suit === leadSuit);
      return removeCard(hand, lowestCard(same.length ? same : hand));
    }
  },
  {
    name: "Meldunkowy Marian",
    bid: () => 110 + Math.floor(Math.random() * 10),
    playCard: (hand, leadSuit) => {
      let nonMeld = hand.filter(c => !(c.rank === 'Q' || c.rank === 'K'));
      let same = nonMeld.filter(c => c.suit === leadSuit);
      return removeCard(hand, lowestCard(same.length ? same : nonMeld.length ? nonMeld : hand));
    }
  },
  {
    name: "Lewiarz Lucjan",
    bid: function () {
      // Bot liczy punkty na ręce i decyduje
      const total = this.hand ? this.hand.reduce((sum, c) => sum + c.value, 0) : 0;
      return total >= 40 ? 120 + Math.floor(Math.random() * 10) : 105;
    },
    playCard: function (hand, leadSuit) {
      const sameSuit = hand.filter(c => c.suit === leadSuit);
      const cards = sameSuit.length ? sameSuit : hand;
      return removeCard(hand, highestCard(cards));
    }
  }
];

// --- Zmienne gry ---
let deck = [];
let player = [];
let bot1 = [];
let bot2 = [];
let mus = [];
let botA, botB; // aktywni boty

// --- Start gry ---
function startGame() {
  deck = createDeck();
  player = deck.splice(0, 7);
  bot1 = deck.splice(0, 7);
  bot2 = deck.splice(0, 7);
  mus = deck.splice(0, 3);

  // Przypisz ręce botom (ważne dla Lewiarza!)
  botA = null;
  botB = null;

  // Losowanie dwóch różnych botów z listy
  const shuffledBots = botList.sort(() => Math.random() - 0.5);
  botA = Object.assign({}, shuffledBots[0]);
  botB = Object.assign({}, shuffledBots[1]);

  // Przypisujemy im ręce (dla funkcji bid Lewiarza)
  botA.hand = [...bot1];
  botB.hand = [...bot2];

  // Wyświetl info o botach
  const botsDiv = document.getElementById('bots-info');
  botsDiv.innerHTML = `Bot 1: <b>${botA.name}</b> | Bot 2: <b>${botB.name}</b>`;

  licytacja();
}

// --- Licytacja ---
function licytacja() {
  const gameDiv = document.getElementById('info');
  let b1 = botA.bid();
  let b2 = botB.bid();

  let highestBotBid = Math.max(b1, b2);
  let minBid = highestBotBid + 5;

  let html = `Licytacja:<br>${botA.name}: ${b1}<br>${botB.name}: ${b2}<br><br>`;
  html += `Twoja kolej - wybierz swoją licytację (min. ${minBid}):<br>`;

  // Przyciski licytacji dla gracza (od minBid do 140 co 5)
  for (let bid = minBid; bid <= 140; bid +=5) {
    html += `<button onclick="wybierzLicytacje(${bid}, ${b1}, ${b2})">${bid}</button> `;
  }
  html += `<br><button onclick="wybierzLicytacje(0, ${b1}, ${b2})">Pas</button>`;

  gameDiv.innerHTML = html;
}

// --- Wybór licytacji przez gracza ---
function wybierzLicytacje(playerBid, b1, b2) {
  const gameDiv = document.getElementById('info');
  if (playerBid === 0) {
    gameDiv.innerHTML = `Pasujesz. Boty grają.<br>`;
    // Tu można dodać rozgrywkę botów bez gracza albo restart
    gameDiv.innerHTML += `<button onclick="startGame()">Nowa gra</button>`;
    return;
  }

  let highest = Math.max(playerBid, b1, b2);
  let winner = '';
  if (playerBid === highest) {
    winner = 'Ty';
    player.push(...mus);
  } else if (b1 === highest) {
    winner = botA.name;
    bot1.push(...mus);
  } else {
    winner = botB.name;
    bot2.push(...mus);
  }

  gameDiv.innerHTML = `Licytację wygrał: <b>${winner}</b> za ${highest} punktów.<br><br>`;
  gameDiv.innerHTML += `<button onclick="pokazReke()">Pokaż swoją rękę</button>`;

  // Tutaj możesz dodać dalszą logikę rozgrywki (lewy, meldunki)
}

// --- Wyświetlanie ręki gracza ---
function pokazReke() {
  const handDiv = document.getElementById('player-hand');
  const infoDiv = document.getElementById('info');
  handDiv.innerHTML = '';
  infoDiv.innerHTML += `<br>Wybierz kartę do zagrania:`;

  player.forEach((card, i) => {
    const btn = document.createElement('button');
    btn.className = 'card';
    btn.textContent = `${card.rank}${card.suit}`;
    btn.onclick = () => zagrajKarte(i);
    handDiv.appendChild(btn);
  });
}

// --- Rozgrywka: gracz zagrywa kartę ---
function zagrajKarte(index) {
  const playerCard = player.splice(index,1)[0];

  const b1Card = botA.playCard(bot1, playerCard.suit);
  const b2Card = botB.playCard(bot2, playerCard.suit);

  const cards = [
    {name: 'Ty', card: playerCard},
    {name: botA.name, card: b1Card},
    {name: botB.name, card: b2Card}
  ];

  // Wyświetl karty w lewie
  const infoDiv = document.getElementById('info');
  let text = 'Zagrane karty:\n';
  cards.forEach(c => text += `${c.name}: ${c.card.rank}${c.card.suit}\n`);
  infoDiv.innerText = text;

  // Tutaj można dodać logikę kto wygrał lewę i liczyć punkty

  pokazReke();

  // Jeśli koniec kart - daj info
  if (player.length === 0) {
    infoDiv.innerText += '\nKoniec rundy!';
  }
}
// --- Zmienne gry do rundy ---
let atut = null;
let currentLeader = null; // kto prowadzi lewę ("Ty", botA.name, botB.name)
let lewy = []; // karta w bieżącej lewie
let playerPoints = 0;
let botAPoints = 0;
let botBPoints = 0;
let meldunki = { player: 0, botA: 0, botB: 0 };

// --- Ustal atut po licytacji ---
// Najprostszy sposób: atut to kolor królowej lub asa z musiku wygranego
function ustalAtut() {
  // dla prostoty weź atut jako kolor asa w musiku (jeśli jest)
  const atutyKarty = mus.find(c => c.rank === 'A') || mus[0];
  atut = atutyKarty.suit;
  const infoDiv = document.getElementById('info');
  infoDiv.innerHTML += `\nAtut to: ${atut}`;
}

// --- Sprawdzenie meldunków ---
// Meldunek: para Król+Dama tego samego koloru w ręce, wart 20 punktów
function sprawdzMeldunki(hand) {
  let meld = 0;
  suits.forEach(suit => {
    let k = hand.find(c => c.rank === 'K' && c.suit === suit);
    let q = hand.find(c => c.rank === 'Q' && c.suit === suit);
    if (k && q) meld += 20;
  });
  return meld;
}

// --- Rozpocznij rundę ---
function startRound() {
  ustalAtut();
  currentLeader = "Ty"; // gracz zaczyna lewę
  lewy = [];
  playerPoints = 0;
  botAPoints = 0;
  botBPoints = 0;
  meldunki.player = sprawdzMeldunki(player);
  meldunki.botA = sprawdzMeldunki(bot1);
  meldunki.botB = sprawdzMeldunki(bot2);

  const infoDiv = document.getElementById('info');
  infoDiv.innerHTML += `\nMeldunki:\nTy: ${meldunki.player}\n${botA.name}: ${meldunki.botA}\n${botB.name}: ${meldunki.botB}\n\nZacznij od zagrania karty!`;

  pokazReke();
}

// --- Sprawdza kto wygrał lewę ---
function ktoWygralLewę(karty) {
  // karty to tablica obiektów: {name, card}
  // Atut bije inne kolory. Jeśli więcej atutów - wygrywa najwyższy atut
  // Jeśli brak atutów w lewie - wygrywa najwyższa karta koloru prowadzącego
  const leadSuit = karty[0].card.suit;

  // Filtrowanie kart atutowych i koloru prowadzącego
  const atuty = karty.filter(k => k.card.suit === atut);
  if (atuty.length > 0) {
    return atuty.reduce((max, cur) => cur.card.value > max.card.value ? cur : max).name;
  } else {
    const leadCards = karty.filter(k => k.card.suit === leadSuit);
    return leadCards.reduce((max, cur) => cur.card.value > max.card.value ? cur : max).name;
  }
}

// --- Liczenie punktów w lewie ---
function policzLewę(karty) {
  return karty.reduce((sum, k) => sum + k.card.value, 0);
}

// --- Zagraj rundę po zagraniach kart (kontynuacja po zagrajKarte) ---
function kontynuujRunde(zagraneKarty) {
  // kto wygrał lewę?
  const winner = ktoWygralLewę(zagraneKarty);
  const pkt = policzLewę(zagraneKarty);

  if (winner === "Ty") playerPoints += pkt;
  else if (winner === botA.name) botAPoints += pkt;
  else botBPoints += pkt;

  const infoDiv = document.getElementById('info');
  infoDiv.innerHTML += `\n${winner} wygrał lewę i zdobywa ${pkt} punktów.`;

  // Nowa kolejka: lider zaczyna
  currentLeader = winner;

  // Sprawdź koniec kart
  if (player.length === 0) {
    // Koniec rundy
    zakonczRunde();
  } else {
    // Kontynuuj: teraz lider zaczyna
    infoDiv.innerHTML += `\nTeraz ruch: ${currentLeader}`;
    if (currentLeader === "Ty") pokazReke();
    else ruchBota(currentLeader);
  }
}

// --- Ruch bota ---
function ruchBota(botName) {
  const infoDiv = document.getElementById('info');

  let hand, botObj;
  if (botName === botA.name) {
    hand = bot1;
    botObj = botA;
  } else if (botName === botB.name) {
    hand = bot2;
    botObj = botB;
  } else return;

  // Bot gra kartę (jeśli jest pierwszy, to wybiera dowolną kartę)
  let leadSuit = null;
  if (lewy.length > 0) leadSuit = lewy[0].card.suit;

  const card = botObj.playCard(hand, leadSuit);

  lewy.push({ name: botName, card });

  infoDiv.innerHTML += `\n${botName} zagrał ${card.rank}${card.suit}`;

  if (lewy.length === 3) {
    // Lewa pełna — rozstrzygnięcie
    kontynuujRunde(lewy);
    lewy = [];
  } else {
    // Następny gracz
    if (botName === botA.name) ruchBota(botB.name);
    else if (botName === botB.name) ruchBota("Ty");
  }
}

// --- Zagraj kartę gracza (dopasowane do rundy) ---
function zagrajKarte(index) {
  const card = player.splice(index, 1)[0];
  const infoDiv = document.getElementById('info');
  infoDiv.innerHTML = `Ty zagrałeś ${card.rank}${card.suit}`;

  lewy.push({ name: "Ty", card });

  if (lewy.length === 3) {
    kontynuujRunde(lewy);
    lewy = [];
  } else {
    // Kolej na botA
    ruchBota(botA.name);
  }

  pokazReke();
}

// --- Zakończenie rundy ---
function zakonczRunde() {
  const infoDiv = document.getElementById('info');

  // Dodaj meldunki do punktów
  playerPoints += meldunki.player;
  botAPoints += meldunki.botA;
  botBPoints += meldunki.botB;

  let wynik = `Koniec rundy!\n\nPunkty:\nTy: ${playerPoints}\n${botA.name}: ${botAPoints}\n${botB.name}: ${botBPoints}`;

  infoDiv.innerText = wynik;

  // Przygotuj przycisk do nowej gry
  const handDiv = document.getElementById('player-hand');
  handDiv.innerHTML = '';
  const botsDiv = document.getElementById('bots-info');
  botsDiv.innerHTML = '';

  const btn = document.createElement('button');
  btn.textContent = 'Zagraj ponownie';
  btn.onclick = () => startGame();
  handDiv.appendChild(btn);
}

// --- Podmiana w funkcji wybierzLicytacje ---
// Po wygranej licytacji, od razu start rundy:

function wybierzLicytacje(playerBid, b1, b2) {
  const gameDiv = document.getElementById('info');
  if (playerBid === 0) {
    gameDiv.innerHTML = `Pasujesz. Boty grają.<br>`;
    gameDiv.innerHTML += `<button onclick="startGame()">Nowa gra</button>`;
    return;
  }

  let highest = Math.max(playerBid, b1, b2);
  let winner = '';
  if (playerBid === highest) {
    winner = 'Ty';
    player.push(...mus);
  } else if (b1 === highest) {
    winner = botA.name;
    bot1.push(...mus);
  } else {
    winner = botB.name;
    bot2.push(...mus);
  }

  gameDiv.innerHTML = `Licytację wygrał: <b>${winner}</b> za ${highest} punktów.<br><br>`;
  startRound();
}
</body>
</html>